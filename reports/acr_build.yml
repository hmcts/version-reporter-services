parameters:
  spACR: ""
  prImage: false
  buildContext: ""
  containerACRRepo: ""
  containerTag: ""

steps:
  - task: Docker@2
    displayName: Login to ACR
    condition: |
      or(
        and(succeeded(),
          eq(variables['isMain'], true),
          eq(variables['isAutoTriggered'], true)),
        and(succeeded(),
          eq('${{ parameters.prImage }}', true),
          eq(variables['isMain'], false),
          eq(variables['Build.Reason'], 'Manual'))
      )
    inputs:
      command: login
      containerRegistry: ${{ parameters.spACR }}

  - task: Docker@2
    displayName: Build Container
    condition: |
      or(
        and(succeeded(),
          eq(variables['isMain'], true),
          eq(variables['isAutoTriggered'], true)),
        and(succeeded(),
          eq('${{ parameters.prImage }}', true),
          eq(variables['isMain'], false),
          eq(variables['Build.Reason'], 'Manual'))
      )
    inputs:
      command: buildAndPush
      containerRegistry: ${{ parameters.spACR }}
      repository: ${{ parameters.containerACRRepo }}
      buildContext: ${{ parameters.buildContext }}
      tags: |
        ${{ parameters.containerTag }}